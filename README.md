# 本地文件AI管理系统

基于 **RAG（检索增强生成）** 技术的本地化AI文档管理系统，支持文档上传、语义搜索与智能对话，**完全本地部署**，所有数据存储在本地，无需云端依赖。

---

## 核心功能

### 1. 智能对话（RAG问答）

- **流式响应**：回答实时增量显示，体验流畅
- **AI思维可视化**：支持查看模型推理过程（thinking内容）
- **来源引用追溯**：明确标注回答依据的文档片段
- **对话历史管理**：支持历史记录保存与回顾
- **可配置检索**：自定义检索片段数量、相似度阈值等参数
- **精确搜索模式**：支持基于特定文档片段的精准问答

### 2. 文档生成

- **智能大纲生成**：基于搜索结果自动生成文档大纲
- **多文档类型支持**：支持生成 Word、PPT 等多种格式文档
- **灵活配置选项**：
  - 生成长度：简短（~500字）、中等（~2000字）、详细（~5000字）
  - 编号格式：阿拉伯数字（1, 2, 3...）
  - 章节数量：1-20章可调
- **流式输出**：大纲生成过程实时显示，支持AI思维可视化
- **内容参考**：基于已上传文档的搜索结果生成相关内容

### 3. 语义搜索

- **向量相似度匹配**：基于BGE模型的精准语义检索
- **分类筛选**：支持按文档类型、创建时间、分类（大类/小类）等维度筛选
- **结果高亮**：搜索关键词在结果中高亮显示
- **原文预览**：快速查看匹配片段的上下文

### 4. 文档管理

- **多格式支持**：PDF、Word(DOCX/DOC)、Markdown、TXT、Excel(XLSX/XLS)、CSV、JSON、PowerPoint(PPTX/PPT)、RTF、HTML/HTM等
- **自动处理**：文本提取、智能分块、批量向量化
- **智能分类**：基于文件名、扩展名、关键词的自动分类系统（支持11个大类，数十个小类）
- **文件去重**：基于MD5哈希值识别重复文件
- **状态追踪**：实时显示文档处理状态（待处理/已完成/失败）
- **批量操作**：支持单个/批量上传、删除与检索

### 5. 文件上传

- **拖拽上传**：支持文件拖拽到界面上传
- **批量上传**：一次选择多个文件上传
- **进度显示**：实时显示上传与处理进度
- **格式检测**：自动识别文件格式并提示

### 6. 自动分类系统

- **智能分类**：基于文件名、扩展名、内容关键词的自动分类
- **多级分类体系**：支持11个大类，数十个小类的精准分类
- **置信度计算**：为每个分类结果提供置信度评分
- **可扩展规则**：支持自定义分类规则和关键词

#### 支持的分类类型

##### 🏢 技术研发类
- 技术架构设计、开发规范文档、API接口规范、数据库设计文档、系统运维手册、测试用例文档、技术方案文档、系统架构图

##### 💼 业务管理类
- 业务流程文档、产品需求文档、市场调研报告、竞品分析报告、商业计划书、运营策略方案、业务规范文档

##### 📊 财务法务类
- 财务报表、预算方案、合同模板、法律条款文档、审计报告、税务筹划方案、成本分析报告

##### 👥 人力资源类
- 招聘流程文档、培训体系文档、绩效考核标准、薪酬福利方案、员工手册、组织架构图、岗位说明书

##### 📈 市场营销类
- 营销策划方案、品牌建设方案、客户分析报告、营销素材库、活动策划方案、新媒体运营方案、市场推广计划

##### 📋 项目管理类
- 项目计划书、需求规格文档、会议纪要、项目进度报告、风险管控方案、项目复盘报告、里程碑文档

##### 🏛️ 行政管理类
- 公司制度、通知公告、办公流程文档、行政记录、供应商管理文档、办公资产管理、流程规范文档

##### 🎓 培训教育类
- 培训课程资料、学习指南、考试题库、技能认证文档、在线学习课程、培训效果评估

##### 🔒 合规安全类
- 信息安全政策、合规审计报告、风险评估报告、应急预案、数据安全管理、合规检查清单

##### 📎 其他文档
- 个人工作文档、临时工作文件、参考资料库、通用模板

---

## 🚀 快速开始

### 1. 环境准备

首次运行前，需要下载模型文件到 `models` 目录：

```bash
# 下载中文嵌入模型
# 从 Hugging Face 下载：https://huggingface.co/BAAI/bge-base-zh-v1.5
# 解压到 models/bge-base-zh-v1.5/

# 下载英文/多语言嵌入模型
# 从 Hugging Face 下载：https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2
# 解压到 models/multilingual-MiniLM-L12-v2/
```

### 2. 配置环境

复制环境变量模板并修改：

```bash
# Windows
copy config\.env.example config\.env

# 编辑 config\.env 文件，配置你的 API 密钥等
```

### 3. 启动应用

**重要**：必须使用 `startall.py` 脚本启动所有服务，禁止手动单独启动服务。

```bash
# Windows - 双击运行
start.bat

# 或命令行运行
python scripts/startall.py
```

### 4. 访问系统

启动成功后，可以通过以下地址访问：

- **系统界面**: http://localhost:9989
- **API 文档**: http://localhost:9988/docs

---

## ⚙️ 配置说明

### 端口配置

系统使用以下端口，请确保端口未被占用：

- **API 服务端口**: 9988
- **BS 服务端口**: 9989

**注意**：系统仅使用端口 9988 和 9989，禁止使用其他端口。

### 环境变量

在 `config/.env` 文件中配置以下变量：

```env
# Ollama配置（必选）
OLLAMA_BASE_URL=http://localhost:11434  # Ollama服务地址
OLLAMA_MODEL=qwen2.5:7b                # Ollama模型名称（如qwen2.5:7b、llama3:8b）

# OpenAI配置（可选，用于替代Ollama）
OPENAI_API_KEY=your-api-key            # OpenAI API密钥
OPENAI_MODEL=gpt-4                     # OpenAI模型名称（如gpt-4、gpt-3.5-turbo）

# 数据库配置
CHROMA_PERSIST_DIR=./file_management/storage/vectors  # 向量数据库存储路径

# 其他配置
LOG_LEVEL=INFO                         # 日志级别（DEBUG/INFO/WARNING/ERROR）
```

### RAG参数配置

可在 `config/settings.py` 中调整以下参数：

- `retrieval_k`: 检索片段数量（默认5，建议1-10）
- `similarity_threshold`: 相似度阈值（默认0.5，建议0.3-0.7）
- `context_max_length`: 上下文最大长度（默认2048，避免模型过载）
- `prompt_template`: 提示词模板（自定义回答格式）

### 路径配置

所有路径都使用相对路径，基于 exe 所在目录：

- **数据库**: `data/database/`
- **上传文件**: `data/file_storage/`
- **日志文件**: `logs/`
- **模型文件**: `models/`

---

## 使用指南

### 1. 上传文档

1. 点击左侧导航栏「文件上传」
2. 拖拽文件到上传区域，或点击「选择文件」按钮
3. 等待处理完成（自动提取文本、分块、向量化）
4. 查看处理结果（成功/失败提示）

### 2. 语义搜索

1. 点击左侧导航栏「语义搜索」
2. 输入搜索关键词（支持中文/英文）
3. 可选：选择分类筛选条件（如文档类型、创建时间）
4. 查看搜索结果列表，点击「查看详情」可展开匹配片段

### 3. 智能对话

1. 点击左侧导航栏「智能对话」
2. 在输入框中输入问题
3. 等待AI生成回答（流式显示，实时更新）
4. 可在右上角配置模型、检索数量等参数
5. 点击「查看来源」可追溯回答依据的文档片段
6. 支持精确搜索模式：选择特定文档片段进行精准问答

### 4. 文档生成

1. 点击左侧导航栏「文档生成」
2. 在左侧搜索框输入关键词，搜索参考内容
3. 配置生成参数：
   - **文档类型**：选择 Word 或 PPT
   - **生成长度**：选择简短、中等或详细
   - **编号格式**：选择阿拉伯数字编号
   - **章节数量**：设置1-20章
4. 点击「生成大纲」按钮
5. 查看AI生成的大纲（支持流式显示和思维过程）
6. 可选择参考内容片段，点击「生成内容」生成完整文档
7. 点击「导出文档」下载生成的文档

---

## 🔧 故障排除

### 问题 1：端口被占用

**症状**: 启动时提示端口已被使用

**解决方案**:
```bash
# Windows - 查找占用端口的进程
netstat -ano | findstr "9988"
netstat -ano | findstr "9989"

# 结束进程
taskkill /PID <进程ID> /F
```

### 问题 2：模型文件未找到

**症状**: 启动时提示模型文件不存在

**解决方案**:
1. 确保模型文件已下载到 `models` 目录
2. 检查模型目录结构是否正确
3. 在 `config/.env` 中配置正确的模型路径

### 问题 3：权限错误

**症状**: 启动时提示权限不足

**解决方案**:
1. 以管理员身份运行
2. 检查 `data` 和 `logs` 目录的写入权限

### 问题 4：Ollama连接失败

- 确保Ollama服务已启动：执行 `ollama serve`
- 检查 `.env` 文件中的 `OLLAMA_BASE_URL` 是否正确（默认 `http://localhost:11434`）
- 确保Ollama模型已下载（如 `ollama pull deepseek-r1:1.5b`）

### 问题 5：向量检索无结果

- 检查文档是否已成功上传并处理（状态为"已完成"）
- 尝试降低相似度阈值（如从0.5调整到0.3）
- 确认嵌入模型是否正确加载（BGE模型路径是否正确）

### 问题 6：服务启动失败

**症状**: 启动脚本执行失败

**解决方案**:
1. 检查Python环境是否正确安装（Python 3.8+）
2. 查看日志文件 `logs/` 目录下的错误日志
3. 确保所有依赖包已正确安装
4. 检查端口9988和9989是否被占用

---

## 📊 系统要求

### 最低配置

- **操作系统**: Windows 10/11 (64位)
- **内存**: 8GB RAM
- **磁盘空间**: 5GB 可用空间
- **网络**: 需要网络连接（用于 AI 模型调用）

### 推荐配置

- **操作系统**: Windows 10/11 (64位)
- **内存**: 16GB RAM
- **磁盘空间**: 10GB 可用空间
- **CPU**: 多核处理器
- **GPU**: NVIDIA GPU（可选，用于加速 AI 推理）

---

## 📝 日志说明

日志文件保存在 `logs` 目录下：

- `api.log`: API 服务日志
- `bs_server.log`: BS 服务日志
- `app.log`: 应用主日志
- `ollama.log`: Ollama模型调用日志
- `rag_handler.log`: RAG处理日志
- `outline_generator.log`: 文档生成日志

日志级别可在 `config/.env` 中配置：
- DEBUG: 详细调试信息
- INFO: 一般信息（默认）
- WARNING: 警告信息
- ERROR: 错误信息
- CRITICAL: 严重错误

---

## 🔒 安全说明

1. **API 密钥**: 请妥善保管你的 API 密钥，不要将 `.env` 文件分享给他人
2. **数据安全**: 上传的文件和数据库都保存在本地，不会上传到云端
3. **网络安全**: 建议在内网环境使用，如需外网访问请配置防火墙

---

## 📞 技术支持

如遇到问题，请：邮件530240412@qq.com

1. 查看 `logs` 目录下的日志文件
2. 检查本文档的故障排除部分
3. 联系技术支持并提供日志信息:

---

## 许可协议：CC BY-NC-4.0 非商业署名许可 + 商业授权补充

### 核心规则
1. **个人/非商业使用**：
   可自由复制、修改、分享本项目，需保留原作者署名（标注项目来源及作者信息）。
2. **商业使用限制**：
   禁止任何商业公司（含企业、盈利机构）未经授权的使用（包括但不限于：集成到商业产品、用于付费服务、企业内部部署等）。
3. **商业授权方式**：
   商业公司如需使用本项目，需联系 [530240412@qq.com/MLvjingyan(微信号)] 协商付费授权，授权条款以双方签订的协议为准。

### 免责声明
本项目仅作技术交流使用，作者不对软件的功能完整性、安全性及使用风险承担法律责任。

（CC BY-NC-4.0 官方文本参考：https://creativecommons.org/licenses/by-nc/4.0/legalcode）

---

## 🔄 更新日志

### v1.0.0 (2026-01-22)
- ✅ 初始发布版本
- ✅ 支持文件上传和管理
- ✅ 支持 AI 驱动的文档搜索
- ✅ 支持自然语言处理
- ✅ 支持 RAG（检索增强生成）
- ✅ 支持多语言文档处理
- ✅ 支持智能对话（流式响应）
- ✅ 支持文档生成功能
- ✅ 支持自动分类系统
- ✅ 改进启动日志格式
- ✅ 优化 ChromaDB 模块打包
- ✅ 修复相关文段显示问题